#!/bin/sh
# Using the csv generated by ./csv_index this creates a
# sqlite3 database of sec filings

database_name="sec_filings.db"
table_name=filings
csv_path="$1"

if ! [ -f "$csv_path" ]
then
    echo "Missing expected first argument: csv file"
    exit 1
fi

sqlite3 $database_name <<CREATE_TABLE_SQL
DROP TABLE IF EXISTS $table_name;

CREATE TABLE $table_name (
             cik TEXT,
             company_name TEXT,
             form_type TEXT,
             date_filed DATE,
             filename TEXT );
CREATE_TABLE_SQL

sqlite3 $database_name <<IMPORT_SQL
.mode csv
.import $csv_path $table_name
IMPORT_SQL

sqlite3 $database_name <<INDEX_SQL
CREATE INDEX cik_idx ON $table_name (cik);
CREATE INDEX form_type_idx ON $table_name (form_type);
INDEX_SQL


sqlite3 $database_name <<DOCUMENTS_SQL
DROP TABLE IF EXISTS documents;

CREATE TABLE documents (
             filename TEXT,
	     data TEXT
);
DOCUMENTS_SQL
