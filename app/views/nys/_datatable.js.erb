$(function(){
  var endpoint = '/nys/datatable';

  var columns = [
    { "data": 'name', "title": 'Name'},
    { "data": 'filer_id', "title": 'Filer ID' },
    { "data": 'entity_match', "title": 'matched entity' },
    { "data": 'match_buttons', "title": 'match buttons' }
  ];

  var datatableOptions = {
    "processing": true,
    "serverSide": true,
    "ordering": false,
    "ajax": endpoint,
    "columns": columns
  };

  // initialize Datatable
  $('#entity-match-table').DataTable(datatableOptions);

  // Functions to handle matching success or failure
  var matchColumn = {
    "success": function(target) {
      $(target).html('<b>matched!</b>');
    },

    "error": function(target) {
      $(target).html('<b class="bg-warn">errored</b>');
    }
  };

  // Bind to ajax calls from rail-ujs
  // see: https://github.com/rails/jquery-ujs
  
  $(document).bind('ajax:success', function(event) {
    matchColumn.success(event.target);
    console.log(event);
  });

  $(document).bind('ajax:error', function(event) {
    matchColumn.error(event.target);
    console.log(event);
  });
});
